/**
 * Instajam
 * Â© 2012 Mike Fowler
 * Instajam may be freely distributed under the MIT license.
 */

(function(){var Instajam;var INSTAGRAM_API_BASE='https://api.instagram.com/v1';Instajam=window.Instajam=function(options){options=options||{};function _request(method,path,data,callback,chain){var request;function getURL(){return path.indexOf("http")===0?path:INSTAGRAM_API_BASE+path;}
data=data||{};if(options.auth=="oauth"&&options.access_token){data.access_token=options.access_token;}
if(options.client_id){data.client_id=options.client_id;}
switch(method){case"PUT":data._method="PUT";method="POST";break;case"DELETE":data._method="DELETE";method="POST";break;}
request=$.ajax({type:method,url:getURL(),dataType:'jsonp',data:data});if(chain&&typeof chain==="boolean"){return request;}
else{request.done(function(data){if(data.meta.code==400){throw new Error('Endpoint "'+path+'": '+data.meta.error_message);}else{callback(data,null);}});request.fail(function(request,status){callback(null,{code:request.status});});}}
this.user={self:function(callback){_request("GET","/users/self",null,function(result,error){callback(result,error);});},feed:function(options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/users/self/feed",options,function(result,error){callback(result,error);});},liked:function(options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/users/self/media/liked",options,function(result,error){callback(result,error);});},get:function(user_id,callback){_request("GET","/users/"+user_id,null,function(result,error){callback(result,error);});},getRecent:function(user_id,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/users/"+user_id+"/media/recent",options,function(result,error){callback(result,error);});},search:function(term,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
options.q=term;_request("GET","/users/search",options,function(result,error){callback(result,error);});},lookup:function(username,callback){this.search(username,null,function(result,error){xcallback(result.data[0],error);});},follows:function(user_id,callback){_request("GET","/users/"+user_id+"/follows",null,function(result,error){callback(result,error);});},following:function(user_id,callback){_request("GET","/users/"+user_id+"/followed-by",null,function(result,error){callback(result,error);});},requests:function(callback){_request("GET","/users/self/requested-by",null,function(result,error){callback(result,error);});},getRelationship:function(user_id,callback){_request("GET","/users/"+user_id+"/relationship",null,function(result,error){callback(result,error);});},setRelationship:function(user_id,action,callback){options=options||{};options.action=action;if(user_id&&action){_request("POST","/users/"+user_id+"/relationship",options,function(result,error){if(typeof callback==="function")callback(result,error);});}else{throw new Error('Endpoint "/users/[user_id]/relationship": user_id and action are required.');}}};this.media={get:function(media_id,callback){_request("GET","/media/"+media_id,null,function(result,error){callback(result,error);});},search:function(options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
if(options.lat&&options.lng){_request("GET","/media/search",options,function(result,error){callback(result,error);});}else{throw new Error('Endpoint "/media/search": "lat" and "lng" options are required.');}},popular:function(callback){_request("GET","/media/popular",null,function(result,error){callback(result,error);});},comments:function(media_id,callback){_request("GET","/media/"+media_id+"/comments",null,function(result,error){callback(result,error);});},addComment:function(media_id,comment,callback){options={};options.text=comment;_request("POST","/media/"+media_id+"/comments",options,function(result,error){callback(result,error);});},removeComment:function(media_id,comment_id,callback){_request("DELETE","/media/"+media_id+"/comments/"+comment_id,null,function(result,error){callback(result,error);});},likes:function(media_id,callback){_request("GET","/media/"+media_id+"/likes",null,function(result,error){callback(result,error);});},like:function(media_id,callback){_request("POST","/media/"+media_id+"/likes",null,function(result,error){callback(result,error);});},unlike:function(media_id,callback){_request("DELETE","/media/"+media_id+"/likes",null,function(result,error){callback(result,error);});}};this.tag={meta:function(tag_name,callback){_request("GET","/tags/"+tag_name,null,function(result,error){callback(result,error);});},get:function(tag_name,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/tags/"+tag_name+"/media/recent",options,function(result,error){callback(result,error);});},search:function(search_term,callback){var options={};options.q=search_term||"";_request("GET","/tags/search",options,function(result,error){callback(result,error);});}};this.location={meta:function(location_id,callback){_request("GET","/locations/"+location_id,null,function(result,error){callback(result,error);});},get:function(location_id,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/locations/"+location_id+"/media/recent",options,function(result,error){callback(result,error);});},search:function(options,callback){options=options||{};if((options.lat!==null&&options.lng!==null)||options.foursquare_v2_id!==null){_request("GET","/locations/search",options,function(result,error){callback(result,error);});}else{throw new Error('Endpoint "/locations/search": Either "lat" and "lng", or "foursquare_v2_id" are required.');}}};this.geography={get:function(geo_id,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/geographies/"+geo_id+"/media/recent",options,function(result,error){callback(result,error);});}};this.nextPage=function(url,callback){_request("GET",url,null,function(result,error){callback(result,error);});};this.chain=function(method,path,options){return _request(method,path,options,null,true);};};}).call(this);